dist: xenial
sudo: true
cache: pip
matrix:
  include:
    - language: python
      python: "3.7"
      install:
        - pip install -r requirements.txt
      script:
        - pytest --cov=core -n 4
    - language: node_js
      node_js:
        - "8"

      sources:
      - google-chrome
      packages:
      - google-chrome-stable

      env:
        - DJANGO_VERSION=2.1.2 DB=postgresql DISPLAY=:99.0 CHROME_BIN=/usr/bin/google-chrome DJANGO_HOST=http://127.0.0.1:8000/api

      install:
        # installs the packages specified in package.json
        - cd react
        - npm install

      before_script:
        # Allows us to run chrome in travis
        - Xvfb :99 &
        - sleep 3 # give xvfb some time to start

      script:
        # enforces front-end code styling
        - npm run-script lint
        # runs the front-end unit tests and coverage
        - npm test -- --single-run
      before_deploy:
        - cd ${TRAVIS_BUILD_DIR}/react
        - npm install
        - npm rebuild node-sass
        - npm run-script build
      deploy:
        provider: s3
        skip_cleanup: true
        access_key_id: AKIAIQW4UVPNI5XCE4FQ
        secret_access_key:
          secure: "skkgUrwkUewerXgMz+kUMmu9mCiDhi0i2B8/J/PQ01gDZ9jkUy/Zh8hdBGbZMTeic0HFH3Q/UdMAHzxZYuKWQ7UJMFb/7+mVICyHA9Dk6SzrNVJUKwzgOti06Zj4YWsy0tNKSlC66t4lgGhEe1z7NWBJynAkmwYtqpSmtsOARq3T4KQm7M5JCC/15+5rNy4ao6w4/jEjMYdbwT4aRuekpVINSJIkLvOgWMt6E+croFOefFZTFZKik/mXYN9258p2paz6YX86pCEbVjpK8qZiGEJbtGC/UpNo9ELnf5HH7IQ81PTz+yg/ge26ip55mZNMFYSyIl07tiUqawtxp2Nfhp09VN22qRiZs4HE6HUaEIl5jwtEuwR/oQwfvJFSNxWEUx6XQCJ3VmboNjJgbo1aFum/4f3arYRw7mPe8TGP7mu/YV+z/ZkXTkH3dcdpDEL8baOd3ewgwDh0wjN6gbZWYeeWBnNykYCoC4iApS20d8ytt3F8l1uX14OM5jBxcgsKptW/zOOULEchiHVsSdzio72LxzJA2LHLb8vYa70bOe6nEv9LFFhhAsfFNURmzEqt9BfMnHMVOIfu5l6vf16DHdvyL/nvLhjH5cCbMQQr27XCRCnSvzqSfox0/JN2ynVjp0yEl2IJdRiQXnXaS7kOoriL7kps3zxbHpJ5o27SCOM="
        bucket: cmput404-i5
        local-dir: ${TRAVIS_BUILD_DIR}/react/dist
        acl: public_read
        on:
          branch: release
