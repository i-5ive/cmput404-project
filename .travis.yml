dist: xenial
sudo: true
cache: pip
matrix:
  include:
  - language: python
    python: '3.7'
    install:
    - pip install -r requirements.txt
    script:
    - pytest --cov=core -n 4
  - language: node_js
    node_js:
    - '8'
    sources:
    - google-chrome
    packages:
    - google-chrome-stable
    env:
    - DJANGO_VERSION=2.1.2 DB=postgresql DISPLAY=:99.0 CHROME_BIN=/usr/bin/google-chrome
      DJANGO_HOST=http://127.0.0.1:8000/api
    install:
    - cd react
    - npm install
    before_script:
    - Xvfb :99 &
    - sleep 3
    script:
    - npm run-script lint
    - npm test -- --single-run
    before_deploy:
    - cd ${TRAVIS_BUILD_DIR}/react
    - npm install
    - npm rebuild node-sass
    - npm run-script build
    deploy:
      provider: s3
      skip_cleanup: true
      region: "us-west-2"
      access_key_id: "AKIAIQW4UVPNI5XCE4FQ"
      secret_access_key:
        secure: "PzBkOX6dF/1iKYYKJwr1trGDf3TdHSTEk33DSGF2tH1CgRxnkL/XRBAa4tWG/heOMdaiedcVKhiR9Ws0POBwFngqkyY91q6B5zm1xh3Im1Xne/m+ZMwZD7w7VF9un+nhdhCQASxhCtIQR+s0AEUyuT0oE12HckdvGDXHWjShsQKY2nfSi3rgH2v22kK9oAB7TdyK2vY48+a8tZ66qjAHl1yRCAoZ7T5sVsN4YeVxMjdDU4pChaGtyEQ+iaSOtYa4acuVMX5CzZ9p3/OwiJhT9eWidW/gi2CBIPT9cXFySDJabas0irALe93MREf4cf6Y/neAZRyBeIk5GU0zlf9I3goolzHsc9dOB9UkH/spKC9rTf+cKbx+rwiFWojoJht3HCTkRM+cYjyQGZoD59+v3nKckWq41csPV53EdgxzEOM6OG2jBbrAM7N0/eDoxaC+s2GkY81kQvjTj6fqPg+NuvJgxa2lzCEAU8bf5xWE39ABPkxLdnc1s4qN2hLwQR8TxOxnV+zIfSALMylXZfKnO701c355gSek3OFJHQBudjbTWfLf3AxgCpHm8lWSXN7aIBN9JJ877Rb+cUgsCRD/IB4uCeG4T2QbNGy4t0vFrABPa7Raka5yev868KDVnEQamvWsR6xFlMaw+6SaiB9GBSA0HwnLpO86uGZnzHS7lFY="
      bucket: "cmput404-i5"
      local-dir: "${TRAVIS_BUILD_DIR}/react/dist"
      acl: public_read
      on:
        branch: release
