dist: xenial
sudo: true
cache: pip
matrix:
  include:
    - language: python
      python: "3.7"
      install:
        - pip install -r requirements.txt
      script:
        - pytest --cov=core -n 4
    - language: node_js
      node_js:
        - "8"

      sources:
      - google-chrome
      packages:
      - google-chrome-stable

      env:
        - DJANGO_VERSION=2.1.2 DB=postgresql DISPLAY=:99.0 CHROME_BIN=/usr/bin/google-chrome DJANGO_HOST=http://127.0.0.1:8000/api

      install:
        # installs the packages specified in package.json
        - cd react
        - npm install

      before_script:
        # Allows us to run chrome in travis
        - Xvfb :99 &
        - sleep 3 # give xvfb some time to start

      script:
        # enforces front-end code styling
        - npm run-script lint
        # runs the front-end unit tests and coverage
        - npm test -- --single-run
      before_deploy:
        - cd ${TRAVIS_BUILD_DIR}/react
        - npm install
        - npm rebuild node-sass
        - npm run-script build
      deploy:
        provider: s3
        skip_cleanup: true
        access_key_id: AKIAIQW4UVPNI5XCE4FQ
        secret_access_key:
          secure: "jFPvOttxXGrJWDIfYES7OIrbCH3xG8ZmJqinCgIobOJMalJU/SoiWp9iMFiIvd7YOco4LUSFmjSKvEH9JkTicerfV8ESSCtUbptbcXn7hYyOhQ62S4cNRSffbgbtIPwZn37W3XaRtxfoOUQczmOwNLIIlPd7tA0n8rCpHmjLPAp9qXVU+Pbx2BOWPLB7uhSViC5LGnnNR1qOGIqmR6erBD8tLgWTAObg6OkI7n2/xHr+tk04FAPdbvEutOFbOj0gjvWPSr/+IM9a3jftVqfQjCM6b3K+TSvtF0akhpbiRooszhmkbwJsG8uGdmeV+Ng5m9iSBGIXfkbD1Nr7nq0MLFzlokBvRgbZKQvTJ+Xy4KLr58RCGqLhvMOtUszHB9Nmc62W+GvW+0iMnNCVObasMMn1I6juSBwXbiWytBszbqmyP0hhqZbX+cvEQoJT7AEabzduJKxCRvBCZVcRbKM+D6tprjb/3N7N7ieod8+oWM9XmhP/CJyotJYZHkV3+L850pAN7npUhiWCQyE6+WkewkWrFMERGv+64fWMJYkai58NFBrb3h60NoAe1QvQHifTtLQXhBlJTfcGOelTjG065sECbChBarH8iNGb7TJEiEZOLQuzTowdDxULi3vKKrlKQ3isP0Y1z06uLyZABMdRW3Vi3vVgcZSOLom7BPXyeIk="

        bucket: cmput404-i5
        local-dir: ${TRAVIS_BUILD_DIR}/react/dist
        acl: public_read
        on:
          branch: release
